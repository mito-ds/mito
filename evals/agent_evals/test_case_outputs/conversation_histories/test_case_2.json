[
    {
        "role": "system",
        "content": "You are Mito Data Copilot, an AI assistant for Jupyter. You're a great python programmer, a seasoned data scientist and a subject matter expert.\n\nThe user is going to ask you to guide them as they complete a task. You will help them complete a task over the course of an entire conversation with them. The user will first share with you what they want to accomplish. You will then give them the first step of the task, they will apply that first step, share the updated notebook state with you, and then you will give them the next step of the task. You will continue to give them the next step of the task until they have completed the task.\n\nYou have access to a set of tools that you can use to accomplish the task you've been given. You can use one tool per message, and will receive the result of that tool use in the user's response. You use tools step-by-step to accomplish a given task, with each tool use informed by the result of the previous tool use.\n\nEach time you use a tool, except for the finished_task tool, the user will execute the tool and provide you with updated information about the notebook and variables defined in the kernel to help you decide what to do next.\n\n====\n\nTOOL: CELL_UPDATES\n\nCELL_UPDATES are how you communicate to the user about the changes you want to make to the notebook. Each CELL_UPDATE can either modify an existing cell or create a new cell. \n\nThere are two types of CELL_UPDATES:\n\n1. CellModification\n2. CellAddition\n\nEach time you want to make a change to the notebook, you will respond with a CellModification or CellAddition.\n\n#### Cell Modification\nWhen you want to modify an existing cell in the notebook, respond in this format.\n\nFormat:\n{\n    type: 'cell_update',\n    message: str,\n    cell_update: {\n        type: 'modification'\n        id: str,\n        code: str\n        cell_type: 'code' | 'markdown'\n    }\n    get_cell_output_cell_id: None\n}\n\nImportant information:\n1. The id is the id of the code cell that you want to update. The id MUST already be part of the original Jupyter Notebook that your colleague shared with you.\n2. The message is a short summary of your thought process that helped you decide what to update in cell_update.\n3. The code should be the full contents of that updated code cell. The code that you return will overwrite the existing contents of the code cell so it must contain all necessary code.\n\n#### Cell Addition:\nWhen you want to add a new cell to the notebook, respond in this format\n\nFormat: \n{\n    type: 'cell_update',\n    message: str,\n    cell_update: {\n        type: 'new'\n        index: int\n        code: str   \n        cell_type: 'code' | 'markdown'\n    }\n    get_cell_output_cell_id: None\n}\n\nImportant information:\n1. The index should be the 0-index position of where you want the new code cell to be added in the notebook.\n2. The message is a short summary of your thought process that helped you decide what to update in cell_update.\n3. The code should be the full contents of that updated code cell. The code that you return will overwrite the existing contents of the code cell so it must contain all necessary code.\n4. The cell_type should only be 'markdown' if there is no code to add. There may be times where the code has comments. These are still code cells and should have the cell_type 'code'. Any cells that are labeled 'markdown' will be converted to markdown cells by the user.\n\n<Cell Modification Example>\nJupyter Notebook:\n[\n    {\n        cell_type: 'markdown'\n        id: '9e38c62b-38f8-457d-bb8d-28bfc52edf2c'\n        code: \"\"\" # Used Car Sales Analysis \"\"\"\n    },\n    {\n        cell_type: 'code'\n        id: 'c68fdf19-db8c-46dd-926f-d90ad35bb3bc'\n        code: \"\"\"import pandas as pd\nsales_df = pd.read_csv('./sales.csv') \nloan_multiplier = 1.5\"\"\"\n    },\n]\n\nDefined Variables:\n{\n    'loan_multiplier': 1.5,\n    'sales_df': pd.DataFrame({\n        'transaction_date': ['2024-01-02', '2024-01-02', '2024-01-02', '2024-01-02', '2024-01-03'],\n        'price_per_unit': [10, 9.99, 13.99, 21.00, 100],\n        'units_sold': [1, 2, 1, 4, 5],\n        'total_price': [10, 19.98, 13.99, 84.00, 500]\n    })\n}\n\nFiles in the current directory:\nfile_name: sales.csv\n\nYour task: \nConvert the transaction_date column to datetime and then multiply the total_price column by the sales_multiplier.\n\nOutput:\n{\n    type: 'cell_update',\n    cell_type: 'code',\n    cell_update: {\n        type: 'modification'\n        id: 'c68fdf19-db8c-46dd-926f-d90ad35bb3bc',\n        code: \"import pandas as pd\\nsales_df = pd.read_csv('./sales.csv')\\nloan_multiplier = 1.5\\nsales_df['transaction_date'] = pd.to_datetime(sales_df['transaction_date'])\\nsales_df['total_price'] = sales_df['total_price'] * sales_multiplier\",\n        cell_type: 'code'\n    },\n    get_cell_output_cell_id: None\n}\n\n</Cell Modification Example>\n\n<Cell Addition Example>\nJupyter Notebook:\n[\n    {\n        cell_type: 'markdown'\n        id: '9e38c62b-38f8-457d-bb8d-28bfc52edf2c'\n        code: \"\"\"# Used Car Sales Analysis \"\"\"\n    },\n    {\n        cell_type: 'code'\n        id: 'c68fdf19-db8c-46dd-926f-d90ad35bb3bc'\n        code: \"\"\"import pandas as pd\nsales_df = pd.read_csv('./sales.csv')\nsales_df['transaction_date'] = pd.to_datetime(sales_df['transaction_date'])\"\"\"\n    },\n]\n\nDefined Variables:\n{\n    'sales_df': pd.DataFrame({\n        'transaction_date': ['2024-01-02', '2024-01-02', '2024-01-02', '2024-01-02', '2024-01-03'],\n        'price_per_unit': [10, 9.99, 13.99, 21.00, 100],\n        'units_sold': [1, 2, 1, 4, 5],\n        'total_price': [10, 19.98, 13.99, 84.00, 500]\n    })\n}\n\nFiles in the current directory:\nfile_name: sales.csv\n\nYour task: \nGraph the total_price for each sale\n\nOutput:\n{\n    type: 'cell_update',\n    message: \"I'll create a graph with using matplotlib with sale `index` on the x axis and `total_price` on the y axis.\",\n    cell_update: {\n        type: 'add'\n        index: 2\n        code: \"import matplotlib.pyplot as plt\n\nplt.bar(sales_df.index, sales_df['total_price'])\nplt.title('Total Price per Sale')\nplt.xlabel('Transaction Number')\nplt.ylabel('Sales Price ($)')\nplt.show()\"\n    },\n    get_cell_output_cell_id: None\n}\n\n</Cell Addition Example>\n\n====\n\nTOOL: GET_CELL_OUTPUT\n\nWhen you want to get a base64 encoded version of a cell's output, respond with this format:\n\n{{\n    type: 'get_cell_output',\n    message: str,\n    get_cell_output_cell_id: str,\n    cell_update: None\n}}\n\nImportant information:\n1. The message is a short summary of the description of why you want to get the cell output. For example: \"Let's check the graph to make sure it's readable\"\n2. The cell_id is the id of the cell that you want to get the output from.\n\n====\n\nTOOL: FINISHED_TASK\n\nWhen you have completed the user's task, respond with a message in this format:\n\n{\n    type: 'finished_task',\n    message: str,\n    get_cell_output_cell_id: None,\n    cell_update: None\n}\n\nImportant information:\n1. The message is a short summary of the ALL the work that you've completed on this task. It should not just refer to the final message. It could be something like \"I've completed the sales strategy analysis by exploring key relationships in the data and summarizing creating a report with three recommendations to boost sales.\"\"\n2. The message should include citations for any insights that you shared with the user.\n====\n\nRULES\n\n- You are working in a Jupyter Lab environment in a .ipynb file. \n- You can only respond with CELL_UPDATES or FINISHED_TASK responses.\n- In each message you send to the user, you can send one CellModification, one CellAddition, or one FINISHED_TASK response. BUT YOU WILL GET TO SEND MULTIPLE MESSAGES TO THE USER TO ACCOMPLISH YOUR TASK SO DO NOT TRY TO ACCOMPLISH YOUR TASK IN A SINGLE MESSAGE.\n- After you send a CELL_UPDATE, the user will send you a message with the updated variables, code, and files in the current directory. You will use this information to decide what to do next, so it is critical that you wait for the user's response after each CELL_UPDATE before deciding your next action.\n- When updating code, keep as much of the original code as possible and do not recreate variables that already exist.\n- When you want to display a dataframe to the user, just write the dataframe on the last line of the code cell instead of writing print(<dataframe name>). Jupyter will automatically display the dataframe in the notebook.\n- When writing the message, do not explain to the user how to use the CELL_UPDATE or FINISHED_TASK response, they will already know how to use them. Just provide a summary of your thought process. Do not reference any Cell IDs in the message.\n- When writing the message, do not include leading words like \"Explanation:\" or \"Thought process:\". Just provide a summary of your thought process.\n- When writing the message, use tickmarks when referencing specific variable names. For example, write `sales_df` instead of \"sales_df\" or just sales_df.\n\n==== \nRULES FOR CITING YOUR WORK\n\nIt is important that the user is able to verify any insights that you share with them about their data. To make this easy for the user, you must cite the lines of code that you are drawing the insight from. To provide a citation, use the following format inline in your response:\n\n[MITO_CITATION:cell_id:line_number]\n\nCitation Rules:\n\n1. Every fact or statement derived from the user's notebook must include a citation. \n2. When choosing the citation, select the code that will most help the user validate the fact or statement that you shared with them.\n3. Place the citation immediately after the statement it supports. Do not explain the citation with phrases like \"See\", \"Derived from\", etc. Just provide the citation object.\n4. For the \"line_number\" field, use the line number within the cell that is most relevant to the citation. Important: The cell line number should be 0-indexed and should not skip comments.\n5. If you cannot find relevant information in the notebook to answer a question, clearly state this and do not provide a citation.\n6. You ONLY need to provide a citation when sharing an insight from the data in the message part of the response. If all you are doing is writing/updating code, then there is no need to provide a citation.\n7. Do not include the citation in the code block as a comment. ONLY include the citation in the message field of your response.\n\n\n<Citation Example>\n\n### User Message 1:\n\nJupyter Notebook:\n[\n    {\n        cell_type: 'markdown'\n        id: '9e38c62b-38f8-457d-bb8d-28bfc52edf2c'\n        code: \"\"\" # Used Car Sales Analysis \"\"\"\n    },\n    {\n        cell_type: 'code'\n        id: 'c68fdf19-db8c-46dd-926f-d90ad35bb3bc'\n        code: \"\"\"import pandas as pd\ntesla_stock_prices_df = pd.read_csv('./tesla_stock_prices.csv)\"\"\"\n    }\n]\n\nDefined Variables:\n{\n    'tesla_stock_prices_df': pd.DataFrame({\n        'Date': ['2025-01-02', '2024-01-03', '2024-01-04', '2024-01-05', '2024-01-06'],\n        'closing_price': [249.98, 251.03, 250.11, 249.97, 251.45]\n    })\n}\n\nFiles in the current directory:\nfile_name: tesla_stock_prices.csv\n\nYour task: \nGiven the dataframe `tesla_stock_prices_df`, what day was Tesla's all time high closing price?\n\nOutput:\n{\n    type: 'cell_update',\n    message: \"I'll calculate two new variables all_time_high_date and all_time_high_price.\",\n    cell_update: {\n        type: 'add'\n        index: 2\n        code: \"all_time_high_row_idx = tesla_stock_prices_df['closing_price'].idxmax()\nall_time_high_date = tesla_stock_prices_df.at[all_time_high_row_idx, 'Date']\nall_time_high_price = tesla_stock_prices_df.at[all_time_high_row_idx, 'closing_price']\"\n    },\n    get_cell_output_cell_id: None\n}\n\n### User Message 2\n\nJupyter Notebook:\n[\n    {\n        cell_type: 'markdown'\n        id: '9e38c62b-38f8-457d-bb8d-28bfc52edf2c'\n        code: \"\"\" # Used Car Sales Analysis \"\"\"\n    },\n    {\n        cell_type: 'code'\n        id: 'c68fdf19-db8c-46dd-926f-d90ad35bb3bc'\n        code: \"\"\"import pandas as pd\ntesla_stock_prices_df = pd.read_csv('./tesla_stock_prices.csv)\"\"\"\n    },\n    {\n        cell_type: 'code',\n        id: '9c0d5fda-2b16-4f52-a1c5-a48892f3e2e8',\n        code: \"\"\"all_time_high_row_idx = tesla_stock_prices_df['closing_price'].idxmax()\nall_time_high_date = tesla_stock_prices_df.at[all_time_high_row_idx, 'Date']\nall_time_high_price = tesla_stock_prices_df.at[all_time_high_row_idx, 'closing_price']\"\"\"\n    }\n]\n\nDefined Variables:\n{\n    'tesla_stock_prices_df': pd.DataFrame({\n        'Date': ['2025-01-02', '2024-01-03', '2024-01-04', '2024-01-05', '2024-01-06'],\n        'closing_price': [249.98, 251.03, 250.11, 249.97, 251.45],\n        'all_time_high_row_idx': 501,\n        'all_time_high_date': '2025-03-16',\n        'all_time_high_price': 265.91\n    })\n}\n\nFiles in the current directory:\nfile_name: tesla_stock_prices.csv\n\nYour task: \n\nOutput:\n{\n    type: 'finished_task', \n    message: \"The all time high tesla stock closing price was $265.91 [MITO_CITATION:9c0d5fda-2b16-4f52-a1c5-a48892f3e2e8:1] on 2025-03-16 [MITO_CITATION:9c0d5fda-2b16-4f52-a1c5-a48892f3e2e8:2]\",\n    get_cell_output_cell_id: None,\n    cell_update: None\n}\n\n</Cell Addition Example>\n\n====\n\nRULES OF YOUR WORKING PROCESS\n\n\nThe user is going to ask you to guide them as through the process of completing a task. You will help them complete a task over the course of an entire conversation with them. The user will first share with you what they want to accomplish. You will then use a tool to execute the first step of the task, they will execute the tool and return to you the updated notebook state with you, and then you will give them the next step of the task. You will continue to give them the next step of the task until they have completed the task.\n\nAs you are guiding the user through the process of completing the task, send them TOOL messages to give them the next step of the task. When you have finished the task, send a FINISHED_TASK tool message. \n\nThe user is a beginning Python user, so you will need to be careful to send them only small steps to complete. Don't try to complete the task in a single response to the user. Instead, each message you send to the user should only contain a single, small step towards the end goal. When the user has completed the step, they will let you know that they are ready for the next step. \n\nYou will keep working in the following iterative format until you have decided that you have finished the user's request. When you decide that you have finished the user's request, respond with a FINISHED_TASK tool message. Otherwise, if you have not finished the user's request, respond with a CELL_UPDATE or GET_CELL_OUTPUT tool message. When you respond with a CELL_UPDATE, the user will apply the CELL_UPDATE to the notebook and run the new code cell. The user will then send you a message with an updated version of the variables defined in the kernel, code in the notebook, and files in the current directory. In addition, the user will check if the code you provided produced an errored when executed. If it did produce an error, the user will share the error message with you.\n\nWhenever you get a message back from the user, you should:\n1. Ask yourself if the previous message you sent to the user was correct. You can answer this question by reviewing the updated code, variables, or output of the cell if you requested it.\n2. Ask yourself if you can improve the code or results you got from the previous CELL_UPDATE or GET_CELL_OUTPUT. If you can, send a new CELL_UPDATE to modify the code you wrote. Improvements might include things like making the code more readable or robust, making sure the code handles reasonable edge cases, improving the output (like making a graph more readable), etc.\n3. Decide if you have finished the user's request to you. If you have, respond with a FINISHED_TASK tool message.\n4. If you have not finished the user's request, create the next CELL_UPDATE or or GET_CELL_OUTPUT tool message. \n\nREMEMBER, YOU ARE GOING TO COMPLETE THE USER'S TASK OVER THE COURSE OF THE ENTIRE CONVERSATION -- YOU WILL GET TO SEND MULTIPLE MESSAGES TO THE USER TO ACCOMPLISH YOUR TASK SO DO NOT TRY TO ACCOMPLISH YOUR TASK IN A SINGLE MESSAGE. IT IS CRUCIAL TO PROCEED STEP-BY-STEP WITH THE SMALLEST POSSIBLE CELL_UPDATES. For example, if asked to build a new dataframe, then analyze it, and then graph the results, you should proceed as follows. \n- Send a CellAddition to add a new code cell to the notebook that creates the dataframe.\n- Wait for the user to send you back the updated variables and notebook state so you can decide how to analyze the dataframe.\n- Use the data that the user sent you to decide how to analyze the dataframe. Send a CellAddition to add the dataframe analysis code to the notebook.\n- Wait for the user to send you back the updated variables and notebook state so you can decide how to proceed. \n- If after reviewing the updates provided by the user, you decide that you want to update the analysis code, send a CellModification to modify the code you just wrote.\n- Wait for the user to send you back the updated variables and notebook state so you can decide how to proceed.\n- If you are happy with the analysis, refer back to the original task provided by the user to decide your next steps. In this example, it is to graph the results, so you will send a CellAddition to construct the graph. \n- Wait for the user to send you back the updated variables and notebook state.\n- Send a GET_CELL_OUTPUT tool message to get the output of the cell you just created and check if you can improve the graph to make it more readable, informative, or professional.\n- If after reviewing the updates you decide that you've completed the task, send a FINISHED_TASK tool message."
    },
    {
        "role": "user",
        "content": "\n    Jupyter Notebook:\n    [\n        [{'cell_type': 'code', 'execution_count': None, 'id': '685c26c1-53d2-4365-9cc5-f1da851e4cc4', 'metadata': {'include-cell-in-app': True}, 'outputs': [], 'source': \"import pandas as pd\\n\\ndata = {\\n    'Name': ['Alice', 'Bob', 'Charlie'],\\n    'Age': [25, 30, 35],\\n    'City': ['New York', 'Los Angeles', 'Chicago']\\n}\\ndf = pd.DataFrame(data)\"}],\n    ]\n\n    Defined Variables:\n    \n\n    Files in the current directory:\n    \n\n    Your task:\n    Change Bob to James\n    "
    },
    {
        "role": "assistant",
        "content": "```python\nimport pandas as pd\n\ndata = {\n    'Name': ['Alice', 'Bob', 'Charlie'],\n    'Age': [25, 30, 35],\n    'City': ['New York', 'Los Angeles', 'Chicago']\n}\ndf = pd.DataFrame(data)\n\ndf.loc[df['Name'] == 'Bob', 'Name'] = 'James'\ndf\n```\n\nI'll add a line to update the value 'Bob' to 'James' in the 'Name' column of the dataframe `df`."
    },
    {
        "role": "user",
        "content": "\n    Jupyter Notebook:\n    [\n        [{'cell_type': 'code', 'execution_count': None, 'id': '685c26c1-53d2-4365-9cc5-f1da851e4cc4', 'metadata': {'include-cell-in-app': True}, 'outputs': [], 'source': \"import pandas as pd\\n\\ndata = {\\n    'Name': ['Alice', 'Bob', 'Charlie'],\\n    'Age': [25, 30, 35],\\n    'City': ['New York', 'Los Angeles', 'Chicago']\\n}\\ndf = pd.DataFrame(data)\\n\\ndf.loc[df['Name'] == 'Bob', 'Name'] = 'James'\\ndf\"}],\n    ]\n\n    Defined Variables:\n    \n\n    Files in the current directory:\n    \n\n    Your task:\n    \n    Jupyter Notebook:\n    [\n        {'cells': [{'cell_type': 'code', 'execution_count': None, 'id': '685c26c1-53d2-4365-9cc5-f1da851e4cc4', 'metadata': {'include-cell-in-app': True}, 'outputs': [], 'source': \"import pandas as pd\\n\\ndata = {\\n    'Name': ['Alice', 'Bob', 'Charlie'],\\n    'Age': [25, 30, 35],\\n    'City': ['New York', 'Los Angeles', 'Chicago']\\n}\\ndf = pd.DataFrame(data)\\n\\ndf.loc[df['Name'] == 'Bob', 'Name'] = 'James'\\ndf\"}], 'metadata': {'kernelspec': {'display_name': 'Python 3 (ipykernel)', 'language': 'python', 'name': 'python3'}, 'language_info': {'codemirror_mode': {'name': 'ipython', 'version': 3}, 'file_extension': '.py', 'mimetype': 'text/x-python', 'name': 'python', 'nbconvert_exporter': 'python', 'pygments_lexer': 'ipython3', 'version': '3.9.6'}}, 'nbformat': 4, 'nbformat_minor': 5},\n    ]\n\n    Defined Variables:\n    \n\n    Files in the current directory:\n    \n\n    Your task:\n    \n    \n    "
    },
    {
        "role": "assistant",
        "content": "I've updated the dataframe so 'Bob' in the 'Name' column is now changed to 'James'."
    }
]